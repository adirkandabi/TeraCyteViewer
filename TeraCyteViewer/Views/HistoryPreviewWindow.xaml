<Window x:Class="TeraCyteViewer.Views.HistoryPreviewWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:TeraCyteViewer.Views"
        Title="Preview" SizeToContent="WidthAndHeight" WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize" Background="#1a1a1a" Opacity="0">
    <Window.Resources>
        <!-- easing -->
        <CubicEase x:Key="EaseOut" EasingMode="EaseOut"/>

        <!-- fade-in on load -->
        <Storyboard x:Key="FadeInSb">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="0" To="1"
                             Duration="0:0:0.25"
                             EasingFunction="{StaticResource EaseOut}"/>
        </Storyboard>

        <!-- fade-out before close -->
        <Storyboard x:Key="FadeOutSb">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="1" To="0"
                             Duration="0:0:0.2"
                             EasingFunction="{StaticResource EaseOut}"/>
        </Storyboard>
    </Window.Resources>

    <Window.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource FadeInSb}"/>
        </EventTrigger>
    </Window.Triggers>

    <Grid Margin="16" Width="900">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Image (שומר על אותם יחס וגודל כמו ב-LiveView, נניח 16:9) -->
        <Border Grid.Column="0" Background="#111" CornerRadius="8" Padding="8" Margin="0,0,12,0">
            <Grid>
                <Viewbox Stretch="Uniform">
                    <Border Width="800" Height="450" Background="#111">
                        <!-- תאם למידות ה-LiveView אם שונות -->
                        <Image Source="{Binding Image}" Stretch="Uniform"/>
                    </Border>
                </Viewbox>
            </Grid>
        </Border>

        <!-- Details + Histogram -->
        <StackPanel Grid.Column="1" Margin="12,0,0,0">
            <TextBlock Text="{Binding ImageId}" Foreground="White" FontWeight="Bold" Margin="0,0,0,8"/>
            <TextBlock Text="{Binding Timestamp, StringFormat=Time: {0:HH\\:mm\\:ss}}" Foreground="Gainsboro"/>
            <TextBlock Text="{Binding Label, StringFormat=Label: {0}}" Foreground="Gainsboro"/>
            <TextBlock Text="{Binding Intensity, StringFormat=Intensity: {0:F2}}" Foreground="Gainsboro"/>
            <TextBlock Text="{Binding Focus, StringFormat=Focus: {0:F2}}" Foreground="Gainsboro" Margin="0,0,0,8"/>

            <TextBlock Text="Histogram" Foreground="White" FontWeight="SemiBold" Margin="0,8,0,4"/>
            <views:HistogramView Data="{Binding Histogram}" Height="160"/>

            <Button Content="Close" Margin="0,12,0,0" Padding="8,4" Click="Close_Click"/>
        </StackPanel>
    </Grid>
</Window>
